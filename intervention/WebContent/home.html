<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<title>Home</title>
<meta name="description" content="Home">
<meta name="viewport" content="width=device-width">
<!-- Material Design fonts -->
<link rel="stylesheet"
	href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700"
	type="text/css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
	rel="stylesheet">



<!-- Bootstrap Material Design -->
<link
	href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
	rel="stylesheet">
<link href="css/bootstrap-material-design.css" rel="stylesheet">
<link href="css/ripples.min.css" rel="stylesheet">
<link href="css/main.css" rel="stylesheet">

<script type="text/javascript" src="js/jquery-1.11.3.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<script type="text/javascript" src="js/ripples.min.js"></script>
<script type="text/javascript" src="js/material.min.js"></script>

<script type="text/javascript" src="js/urls.js"></script>
<script type="text/javascript" src="js/utils.js"></script>
<script type="text/javascript"
	src="http://www.parsecdn.com/js/parse-latest.js"></script>

<script>
	$.material.init();
</script>
</head>
<body>
<nav class="navbar_global navbar navbar-default navbar-static-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      
      <a class="navbar-brand" href="javascript:Utils.goPage(Urls.HOME);">Intervention <i>Online</i></a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
   
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Signed in as <span class="username">[UserName]</span> <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="#" >Settings</a></li>
			<li><a href="javascript:Utils.logout()" >Logout</a></li>
          </ul>
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="container">
<div class="row">

      <div class="col-md-12">
        <div class="bs-component">
          <div class="jumbotron">
          <h1>Welcome to Beta!</h1>
			<p>This is an open source project focused on automating the board game, <a href="https://www.playintervention.com/">Intervention</a>.</p>
			<p>
			<button type="button" class="login btn btn-raised btn-primary" onclick="javascript:Utils.goPage(Urls.GITHUB)">Github</button>
			</p>
          </div>
        </div>
    </div>
	
</div>



<div class="row">
		<div class="col-md-12">
		<div class="error alert alert-success" role="alert"></div>
		</div>
</div>
<div class="row">
	<div class="text-center col-md-4">
		<button type="button" class="create btn btn-lg btn-primary btn-block btn-raised" >Create Game</button>
		<div class="loading" style="display:none"> ...Generating Game... </div>
		
			<div class="game_created" style="display:none">
					<p><h4>Share this code to have players join your game</h4></p>
					<span class="generated_code"></span>
					<br/>
					<button type="button" class="login btn btn-raised btn-primary" onclick="javascript:goToManagePage()">Manage Your Game <span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span></button>
			</div>
		
	</div>
	
	<div class="text-center col-md-4">
		<h2>Or</h2>
	</div>
	<div class="text-center col-md-4">
		<button type="button" class="join btn btn-primary btn-lg btn-block btn-raised" >Join Game</button>
	</div>
	
</div>
</div>

</body>
<script>
$(document).ready(function() {
	if(!Utils.userLoggedIn()){
		Utils.goPage(Urls.LOGIN);
	}
	
	//setting username
	var user = Parse.User.current();
	$(".username").html(user.get("displayName"));
	
});

var manageURL;

$(".create").click(function(event) {
		create();
	});
	
	function create(){
		$(".loading").show("slow");
		$('.create').prop('disabled', true);
		getId()
	
	}
	
	//need to find a unique game id
	function getId(){
		
		var nRandomID = Utils.getRandomInt(Utils.GAME_ID_MIN, Utils.GAME_ID_MAX);
		
		var GameScore = Parse.Object.extend("game");
		var query = new Parse.Query(GameScore);
		query.equalTo("unique_id", String(nRandomID));
		query.find({
		  success: function(results) {
		  if(results.length>0){
			 return getId(); 
			} else {
			idFound(nRandomID);
			}
		  },
		  error: function(error) {
			idFound(nRandomID);
		  }
		});
	}
	
	function idFound(id){
		$(".loading").hide("slow",function(){
		$(".game_created").show("slow");
		
		
		$(".generated_code").html(id);
		
		var user = Parse.User.current();
		var userId = user.id;
		var link="manage.landing.html?ownerId="+userId+"&gameId="+id;
		manageURL = link;
		
		});
		
	}
	
	
	function goToManagePage(){
		alert(manageURL);
	}
	

</script>
</html>