<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<title>Play</title>
<meta name="description" content="Play">
<meta name="viewport" content="width=device-width">
<!-- Material Design fonts -->
<link rel="stylesheet"
	href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700"
	type="text/css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
	rel="stylesheet">



<!-- Bootstrap Material Design -->
<link
	href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
	rel="stylesheet">
<link href="css/bootstrap-material-design.css" rel="stylesheet">
<link href="css/ripples.min.css" rel="stylesheet">
<link href="css/main.css" rel="stylesheet">

<script type="text/javascript" src="js/jquery-1.11.3.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<script type="text/javascript" src="js/ripples.min.js"></script>
<script type="text/javascript" src="js/material.min.js"></script>

<script type="text/javascript" src="js/urls.js"></script>
<script type="text/javascript" src="js/utils.js"></script>
<script type="text/javascript"
	src="http://www.parsecdn.com/js/parse-latest.js"></script>

<script>
	$.material.init();
</script>
</head>
<body>
<nav class="navbar_global navbar navbar-default navbar-static-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      
      <a class="navbar-brand" href="javascript:Utils.goPage(Urls.HOME);">Intervention <i>Online</i></a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
 
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Signed in as <span class="username">[UserName]</span> 
		  (<span class="career_score">0</span>)<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="#" >Settings</a></li>
			<li><a href="javascript:Utils.logout()" >Logout</a></li>
          </ul>
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="container">
<div class="row">

      <div class="col-md-12">
        <div class="bs-component">
          <div class="jumbotron">
		  <h1>Welcome <span class="username">[UserName]</span> </h1>
		
          <h2>Game code</h2>
			<h3><span class="generated_code"></span></h3><br>
			<span class="game_status"></span>
          </div>
        </div>
    </div>
	
</div>
<div class="row">
		<div class="col-md-12">
		<div class="error alert alert-dismissible alert-danger" style="display:none" role="alert"></div>
		</div>
</div>



	
</div>

</body>
<script>
var gameId;
var ownerId;
//parse objects
var game;
var owner;

//interval timer objects
var timer_getJoinedPlayers;

var listOfPlayers = [];

$(document).ready(function() {
	if(!Utils.userLoggedIn()){
		Utils.goPage(Urls.LOGIN);
	}
	
	//setting username
	var user = Parse.User.current();
	$(".username").html(user.get("displayName"));
	$(".career_score").html(user.get("total_career_score"));
	
	gameId = Utils.getParameterByName("gameId");
	
	grabObjects();
});

//gameId and ownerId must be set.
function grabObjects(){

	var currentgame = Parse.Object.extend("game");
	var query = new Parse.Query(currentgame);
	query.equalTo("unique_id", gameId);
	query.equalTo("active",true);
	query.first({
	  success: function(object) {
		game = object;
		if(game.get("owner_id")==Utils.getCurrentUser(false).id){
			Utils.showError("You are the manager of this game! Go to the <a href='manage.html?gameId="+gameId+"'>Manager Page</a>");
			return;
		} else {
			owner = Utils.getCurrentUser(false);
		}
		
		initGame();
	  },
	  error: function(error) {
		Utils.showError(error.message);
	  }
	});
}

function initGame(){
	if(game.get("started")){
		Utils.showError("This game has started, you cannot join now");
		Utils.goPage(Urls.HOME);
	} else {
	
		$(".generated_code").html(Utils.formatCode(game.get("unique_id")));
		
		Utils.setUserProperty("game_id",gameId);
		console.log("setting game_id for this user");
	}
	
}




	

</script>
</html>